[åŽŸæ–‡é“¾æŽ¥ï¼šã€Šè¶…è¯¦ç»†â€œé›¶â€åŸºç¡€kafkaå…¥é—¨ç¯‡ã€‹](https://www.cnblogs.com/along21/p/10278100.html)

> åŽŸæ–‡ä¸­å¾ˆå¤šå†…å®¹è¯»èµ·æ¥ä¸é€šé¡ºï¼Œåè¯ä¸€ä¼šå„¿ç”¨ä¸­æ–‡ï¼Œä¸€ä¼šå„¿ç”¨è‹±æ–‡ï¼Œæ¯”å¦‚  consumer ï¼Œæ–‡ä¸­éƒ¨åˆ†ä½ç½®å°†å…¶ç¿»è¯‘ä¸º æ¶ˆè´¹è€…ï¼Œéƒ¨åˆ†ä½ç½®åˆç¿»è¯‘ä¸º ä½¿ç”¨è€…ï¼Œæ‰€ä»¥ï¼Œä¸¥é‡æ€€ç–‘æ–‡ç« æ˜¯æœºç¿»çš„ã€‚è™½ç„¶å†…å®¹å¾ˆå…¨å¾ˆç»†ï¼Œä½†è¯»èµ·æ¥å¾ˆç´¯ðŸ˜¢
> 
> CnPeng 2020-12-22 æˆ‘è¯»ä¸ä¸‹åŽ»äº†ã€‚ã€‚ã€‚ã€‚

---

## 1.1 è®¤è¯† kafka

**Kafka æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æµåª’ä½“å¹³å°**

kafkaå®˜ç½‘ï¼š[http://kafka.apache.org/](http://kafka.apache.org/)

### 1.1.1 kafka ç®€ä»‹

#### 1.1.1.1 æµåª’ä½“å¹³å°æœ‰ä¸‰ä¸ªå…³é”®åŠŸèƒ½ï¼š

 * **å‘å¸ƒå’Œè®¢é˜…è®°å½•æµ**ï¼Œç±»ä¼¼äºŽæ¶ˆæ¯é˜Ÿåˆ—æˆ–ä¼ä¸šæ¶ˆæ¯ä¼ é€’ç³»ç»Ÿã€‚
 * ä»¥å®¹é”™çš„**æŒä¹…æ–¹å¼å­˜å‚¨è®°å½•æµ**ã€‚
 * **è®°å½•å‘ç”Ÿæ—¶å¤„ç†æµ**ã€‚
 

#### 1.1.1.2 Kafka é€šå¸¸ç”¨äºŽä¸¤å¤§ç±»åº”ç”¨ï¼š

 * æž„å»ºå¯åœ¨ç³»ç»Ÿæˆ–åº”ç”¨ç¨‹åºä¹‹é—´å¯é èŽ·å–æ•°æ®çš„**å®žæ—¶æµæ•°æ®ç®¡é“**
 * æž„å»ºè½¬æ¢æˆ–å“åº”æ•°æ®æµçš„**å®žæ—¶æµåº”ç”¨ç¨‹åº**

è¦äº†è§£ Kafka å¦‚ä½•åšè¿™äº›äº‹æƒ…ï¼Œè®©æˆ‘ä»¬æ·±å…¥æŽ¢è®¨ Kafka çš„èƒ½åŠ›ã€‚

 

#### 1.1.1.2 é¦–å…ˆæ˜¯å‡ ä¸ªæ¦‚å¿µï¼š

 * Kafka ä½œä¸ºä¸€ä¸ªé›†ç¾¤è¿è¡Œåœ¨ä¸€ä¸ªæˆ–å¤šä¸ªå¯è·¨å¤šä¸ªæ•°æ®ä¸­å¿ƒçš„æœåŠ¡å™¨ä¸Šã€‚
 * Kafka é›†ç¾¤ä»¥ç§°ä¸º `topicsä¸»é¢˜` çš„ç±»åˆ«å­˜å‚¨è®°å½•æµã€‚
 * æ¯æ¡è®°å½•éƒ½åŒ…å«ä¸€ä¸ª **`é”®`**ï¼Œä¸€ä¸ª **`å€¼`** å’Œä¸€ä¸ª **`æ—¶é—´æˆ³`**ã€‚
 

#### 1.1.1.3 Kafka æœ‰å››ä¸ªæ ¸å¿ƒ APIï¼š

* **`Producer APIï¼ˆç”Ÿäº§è€…APIï¼‰`**: å…è®¸åº”ç”¨ç¨‹åºå‘å¸ƒè®°å½•æµè‡³ä¸€ä¸ªæˆ–å¤šä¸ª kafka çš„ `topicsï¼ˆä¸»é¢˜ï¼‰`ã€‚
* **`Consumer APIï¼ˆæ¶ˆè´¹è€…APIï¼‰`**: å…è®¸åº”ç”¨ç¨‹åºè®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ª `topicsï¼ˆä¸»é¢˜ï¼‰`ï¼Œå¹¶å¤„ç†æ‰€äº§ç”Ÿçš„å¯¹ä»–ä»¬è®°å½•çš„æ•°æ®æµã€‚
* **`Streams APIï¼ˆæµAPIï¼‰`**: å…è®¸åº”ç”¨ç¨‹åºå……å½“æµå¤„ç†å™¨ï¼Œä»Žä¸€ä¸ªæˆ–å¤šä¸ª `topicsï¼ˆä¸»é¢˜ï¼‰`æ¶ˆè€—çš„è¾“å…¥æµï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªè¾“å‡ºæµè‡³ä¸€ä¸ªæˆ–å¤šä¸ªè¾“å‡ºçš„ `topicsï¼ˆä¸»é¢˜ï¼‰`ï¼Œæœ‰æ•ˆåœ°å˜æ¢æ‰€è¿°è¾“å…¥æµï¼Œä»¥è¾“å‡ºæµã€‚
* **`Connector APIï¼ˆè¿žæŽ¥å™¨APIï¼‰`**: å…è®¸æž„å»ºå’Œè¿è¡Œ kafka `topicsï¼ˆä¸»é¢˜ï¼‰` è¿žæŽ¥åˆ°çŽ°æœ‰çš„åº”ç”¨ç¨‹åºæˆ–æ•°æ®ç³»ç»Ÿä¸­é‡ç”¨ç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…ã€‚ä¾‹å¦‚ï¼Œå…³ç³»æ•°æ®åº“çš„è¿žæŽ¥å™¨å¯èƒ½æ•èŽ·å¯¹è¡¨çš„æ¯ä¸ªæ›´æ”¹ã€‚

![](pics/1-1.png)

åœ¨ Kafka ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ˜¯é€šè¿‡ç®€å•ï¼Œé«˜æ€§èƒ½ï¼Œè¯­è¨€æ— å…³çš„ **TCP åè®®** å®Œæˆçš„ã€‚æ­¤åè®®å·²ç‰ˆæœ¬åŒ–å¹¶ä¿æŒä¸Žæ—§ç‰ˆæœ¬çš„å‘åŽå…¼å®¹æ€§ã€‚Kafka æä¾› Java å®¢æˆ·ç«¯ï¼Œä½†å®¢æˆ·ç«¯æœ‰å¤šç§è¯­è¨€ç‰ˆæœ¬ã€‚

## 1.2 Topics ä¸»é¢˜ å’Œ partitions åˆ†åŒº

æˆ‘ä»¬é¦–å…ˆæ·±å…¥äº†è§£ Kafka ä¸ºè®°å½•æµæä¾›çš„æ ¸å¿ƒæŠ½è±¡ - `ä¸»é¢˜topics`

* ä¸€ä¸ª `Topic` å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç±»æ¶ˆæ¯ï¼Œæ¯ä¸ª `topic` å°†è¢«åˆ†æˆå¤šä¸ª `partition(åŒº)`,æ¯ä¸ª `partition` åœ¨å­˜å‚¨å±‚é¢æ˜¯ `append log` æ–‡ä»¶

* **topic ä¸»é¢˜æ˜¯å‘å¸ƒè®°å½•çš„ç±»åˆ«æˆ–è®¢é˜…æºåç§°**ã€‚Kafka çš„ä¸»é¢˜æ€»æ˜¯å¤šç”¨æˆ·; ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªä¸»é¢˜å¯ä»¥æœ‰é›¶ä¸ªï¼Œä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆè´¹è€…è®¢é˜…å†™å…¥å®ƒçš„æ•°æ®ã€‚

å¯¹äºŽæ¯ä¸ªä¸»é¢˜ï¼ŒKafka ç¾¤é›†éƒ½ç»´æŠ¤ä¸€ä¸ªå¦‚ä¸‹æ‰€ç¤ºçš„ `åˆ†åŒº` æ—¥å¿—ï¼š

![1-2-](pics/1-2.png)


**æ¯ä¸ªåˆ†åŒºéƒ½æ˜¯ä¸€ä¸ªæœ‰åºçš„**ï¼Œä¸å¯å˜çš„è®°å½•åºåˆ—ï¼Œä¸æ–­é™„åŠ åˆ°ç»“æž„åŒ–çš„æäº¤æ—¥å¿—ä¸­ã€‚åˆ†åŒºä¸­çš„è®°å½•æ¯ä¸ªéƒ½åˆ†é…äº†ä¸€ä¸ªç§°ä¸º**åç§»**çš„**é¡ºåºIDå·**ï¼Œ**å®ƒå”¯ä¸€åœ°æ ‡è¯†åˆ†åŒºä¸­çš„æ¯ä¸ªè®°å½•**ã€‚

**Kafka é›†ç¾¤æŒä¹…ä¿å­˜æ‰€æœ‰å·²å‘å¸ƒçš„è®°å½•ï¼Œç›´åˆ°ä¿ç•™æœŸç»“æŸæ‰ä¼šä¸¢å¼ƒè®°å½•**ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœä¿ç•™ç­–ç•¥è®¾ç½®ä¸ºä¸¤å¤©ï¼Œåˆ™åœ¨å‘å¸ƒè®°å½•åŽçš„ä¸¤å¤©å†…ï¼Œå®ƒå¯ä¾›ä½¿ç”¨ï¼Œä¹‹åŽå°†è¢«ä¸¢å¼ƒä»¥é‡Šæ”¾ç©ºé—´ã€‚Kafka çš„æ€§èƒ½åœ¨æ•°æ®å¤§å°æ–¹é¢å®žé™…ä¸Šæ˜¯æ’å®šçš„ï¼Œå› æ­¤é•¿æ—¶é—´å­˜å‚¨æ•°æ®ä¸æ˜¯é—®é¢˜ã€‚

![](pics/1-3.png)

å®žé™…ä¸Šï¼Œ**åŸºäºŽæ¯ä¸ªæ¶ˆè´¹è€…ä¿ç•™çš„å”¯ä¸€å…ƒæ•°æ®æ˜¯è¯¥æ¶ˆè´¹è€…åœ¨æ—¥å¿—ä¸­çš„åç§»æˆ–ä½ç½®**ã€‚è¿™ç§åç§»ç”±æ¶ˆè´¹è€…æŽ§åˆ¶ï¼šé€šå¸¸æ¶ˆè´¹è€…åœ¨è¯»å–è®°å½•æ—¶ä¼šçº¿æ€§åœ°æé«˜å…¶åç§»é‡ï¼Œä½†äº‹å®žä¸Šï¼Œç”±äºŽè¯¥ä½ç½®ç”±æ¶ˆè´¹è€…æŽ§åˆ¶ï¼Œå› æ­¤å®ƒå¯ä»¥æŒ‰ç…§è‡ªå·±å–œæ¬¢çš„ä»»ä½•é¡ºåºæ¶ˆè´¹è®°å½•ã€‚ä¾‹å¦‚ï¼Œæ¶ˆè´¹è€…å¯ä»¥é‡ç½®ä¸ºè¾ƒæ—§çš„åç§»é‡æ¥é‡æ–°å¤„ç†è¿‡åŽ»çš„æ•°æ®ï¼Œæˆ–è€…è·³åˆ°æœ€è¿‘çš„è®°å½•å¹¶ä»Žâ€œçŽ°åœ¨â€å¼€å§‹æ¶ˆè´¹ã€‚

è¿™äº›åŠŸèƒ½ç»„åˆæ„å‘³ç€ Kafka `æ¶ˆè´¹è€…consumers` éžå¸¸ cheap - ä»–ä»¬å¯ä»¥æ¥æ¥å¾€å¾€å¯¹é›†ç¾¤æˆ–å…¶ä»–æ¶ˆè´¹è€…æ²¡æœ‰å¤ªå¤§å½±å“ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„å‘½ä»¤è¡Œå·¥å…· â€œtailâ€ ä»»ä½•ä¸»é¢˜çš„å†…å®¹ï¼Œè€Œæ— éœ€æ›´æ”¹ä»»ä½•çŽ°æœ‰ä½¿ç”¨è€…æ‰€æ¶ˆè€—çš„å†…å®¹ã€‚

æ—¥å¿—ä¸­çš„åˆ†åŒºæœ‰å¤šç§ç”¨é€”ã€‚é¦–å…ˆï¼Œå®ƒä»¬å…è®¸æ—¥å¿—æ‰©å±•åˆ°è¶…å‡ºé€‚åˆå•ä¸ªæœåŠ¡å™¨çš„å¤§å°ã€‚æ¯ä¸ªå•ç‹¬çš„åˆ†åŒºå¿…é¡»é€‚åˆæ‰˜ç®¡å®ƒçš„æœåŠ¡å™¨ï¼Œä½†ä¸»é¢˜å¯èƒ½æœ‰è®¸å¤šåˆ†åŒºï¼Œå› æ­¤å®ƒå¯ä»¥å¤„ç†ä»»æ„æ•°é‡çš„æ•°æ®ã€‚å…¶æ¬¡ï¼Œå®ƒä»¬å……å½“äº†å¹¶è¡Œæ€§çš„å•ä½ - æ›´å¤šçš„æ˜¯å®ƒã€‚

## 1.3 Distribution åˆ†é…

ä¸€ä¸ª `Topic` çš„å¤šä¸ª `partitions`, è¢«åˆ†å¸ƒåœ¨ kafka é›†ç¾¤ä¸­çš„å¤šä¸ª `server` ä¸Š; æ¯ä¸ª`server( kafka å®žä¾‹)` è´Ÿè´£ `partitions` ä¸­æ¶ˆæ¯çš„è¯»å†™æ“ä½œ; æ­¤å¤– kafka è¿˜å¯ä»¥é…ç½® `partitions` éœ€è¦å¤‡ä»½çš„ä¸ªæ•° (`replicas`),æ¯ä¸ª `partition` å°†ä¼šè¢«å¤‡ä»½åˆ°å¤šå°æœºå™¨ä¸Š,ä»¥æé«˜å¯ç”¨æ€§.

åŸºäºŽ `replicated` æ–¹æ¡ˆ,é‚£ä¹ˆå°±æ„å‘³ç€éœ€è¦å¯¹å¤šä¸ªå¤‡ä»½è¿›è¡Œè°ƒåº¦; 

æ¯ä¸ª `partition` éƒ½æœ‰ä¸€ä¸ª `server` ä¸º `leader`; `leader` è´Ÿè´£æ‰€æœ‰çš„è¯»å†™æ“ä½œ,å¦‚æžœ`leader` å¤±æ•ˆ,é‚£ä¹ˆå°†ä¼šæœ‰å…¶ä»– `follower` æ¥æŽ¥ç®¡(æˆä¸ºæ–°çš„ `leader` );

`follower`åªæ˜¯å•è°ƒçš„å’Œ `leader` è·Ÿè¿›,åŒæ­¥æ¶ˆæ¯å³å¯.

ç”±æ­¤å¯è§ä½œä¸º `leader` çš„ `server` æ‰¿è½½äº†å…¨éƒ¨çš„è¯·æ±‚åŽ‹åŠ›,å› æ­¤ä»Žé›†ç¾¤çš„æ•´ä½“è€ƒè™‘,æœ‰å¤šå°‘ä¸ª `partitions` å°±æ„å‘³ç€æœ‰å¤šå°‘ä¸ª `leader` ,kafka ä¼šå°† `leader` å‡è¡¡çš„åˆ†æ•£åœ¨æ¯ä¸ªå®žä¾‹ä¸Š,æ¥ç¡®ä¿æ•´ä½“çš„æ€§èƒ½ç¨³å®šã€‚


## 1.4 Producers ç”Ÿäº§è€…å’Œ Consumers æ¶ˆè´¹è€…

### 1.4.1 Producers ç”Ÿäº§è€…

`Producers` å°†æ•°æ®å‘å¸ƒåˆ°æŒ‡å®šçš„ `topics ä¸»é¢˜`ã€‚åŒæ—¶ `Producer` ä¹Ÿèƒ½å†³å®šå°†æ­¤æ¶ˆæ¯å½’å±žäºŽå“ªä¸ª`partition`; æ¯”å¦‚åŸºäºŽ `round-robin` æ–¹å¼æˆ–è€…é€šè¿‡å…¶ä»–çš„ä¸€äº›ç®—æ³•ç­‰ã€‚

 
### 1.4.2 Consumers

* æœ¬è´¨ä¸Š kafka åªæ”¯æŒ `Topic` .æ¯ä¸ª `consumer` å±žäºŽä¸€ä¸ª `consumer group` ;åè¿‡æ¥è¯´,æ¯ä¸ª`group` ä¸­å¯ä»¥æœ‰å¤šä¸ª `consumer` .å‘é€åˆ° `Topic` çš„æ¶ˆæ¯,åªä¼šè¢«è®¢é˜…æ­¤ `Topic` çš„æ¯ä¸ª `group` ä¸­çš„ä¸€ä¸ª `consumer`æ¶ˆè´¹ã€‚

* å¦‚æžœæ‰€æœ‰ä½¿ç”¨è€…å®žä¾‹å…·æœ‰**ç›¸åŒçš„ä½¿ç”¨è€…ç»„**ï¼Œåˆ™è®°å½•å°†æœ‰æ•ˆåœ°åœ¨ä½¿ç”¨è€…å®žä¾‹ä¸Šè¿›è¡Œ**è´Ÿè½½å¹³è¡¡**ã€‚

* å¦‚æžœæ‰€æœ‰æ¶ˆè´¹è€…å®žä¾‹å…·æœ‰**ä¸åŒçš„æ¶ˆè´¹è€…ç»„**ï¼Œåˆ™æ¯ä¸ªè®°å½•å°†**å¹¿æ’­**åˆ°æ‰€æœ‰æ¶ˆè´¹è€…è¿›ç¨‹ã€‚

![](pics/1-4.png)


ä¸Šå›¾ä¸­ï¼Œæœ‰ä¸¤ä¸ªæœåŠ¡å™¨ Kafka é›†ç¾¤ï¼Œæ‰˜ç®¡å››ä¸ªåˆ†åŒºï¼ˆP0-P3ï¼‰ï¼ŒåŒ…å«ä¸¤ä¸ªä½¿ç”¨è€…ç»„ã€‚æ¶ˆè´¹è€…ç»„ A æœ‰ä¸¤ä¸ªæ¶ˆè´¹è€…å®žä¾‹ï¼ŒB ç»„æœ‰å››ä¸ªæ¶ˆè´¹è€…å®žä¾‹ã€‚


åœ¨ Kafka ä¸­å®žçŽ°æ¶ˆè´¹ `consumption` çš„æ–¹å¼æ˜¯é€šè¿‡**åœ¨æ¶ˆè´¹è€…å®žä¾‹ä¸Šåˆ’åˆ†æ—¥å¿—ä¸­çš„åˆ†åŒºï¼Œä»¥ä¾¿æ¯ä¸ªå®žä¾‹åœ¨ä»»ä½•æ—¶é—´ç‚¹éƒ½æ˜¯åˆ†é…çš„â€œå…¬å¹³ä»½é¢â€çš„ç‹¬å æ¶ˆè´¹è€…**ã€‚ç»´æŠ¤ç»„ä¸­æˆå‘˜èµ„æ ¼çš„è¿‡ç¨‹ç”± Kafka åè®®åŠ¨æ€å¤„ç†ã€‚å¦‚æžœæ–°å®žä¾‹åŠ å…¥è¯¥ç»„ï¼Œä»–ä»¬å°†ä»Žè¯¥ç»„çš„å…¶ä»–æˆå‘˜æŽ¥ç®¡ä¸€äº›åˆ†åŒº; å¦‚æžœå®žä¾‹æ­»äº¡ï¼Œå…¶åˆ†åŒºå°†åˆ†å‘ç»™å…¶ä½™å®žä¾‹ã€‚

**Kafka ä»…æä¾›åˆ†åŒºå†…è®°å½•çš„æ€»è®¢å•ï¼Œè€Œä¸æ˜¯ä¸»é¢˜ä¸­ä¸åŒåˆ†åŒºä¹‹é—´çš„è®°å½•**ã€‚å¯¹äºŽå¤§å¤šæ•°åº”ç”¨ç¨‹åºè€Œè¨€ï¼ŒæŒ‰åˆ†åŒºæŽ’åºä¸ŽæŒ‰é”®åˆ†åŒºæ•°æ®çš„èƒ½åŠ›ç›¸ç»“åˆå°±è¶³å¤Ÿäº†ã€‚ä½†æ˜¯ï¼Œå¦‚æžœæ‚¨éœ€è¦å¯¹è®°å½•è¿›è¡Œæ€»è®¢å•ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»…åŒ…å«ä¸€ä¸ªåˆ†åŒºçš„ä¸»é¢˜æ¥å®žçŽ°ï¼Œä½†è¿™å°†æ„å‘³ç€æ¯ä¸ªä½¿ç”¨è€…ç»„åªæœ‰ä¸€ä¸ªä½¿ç”¨è€…è¿›ç¨‹ã€‚

## 1.5 Consumers kafka ç¡®ä¿

* å‘é€åˆ° `partitions` ä¸­çš„æ¶ˆæ¯å°†ä¼šæŒ‰ç…§å®ƒæŽ¥æ”¶çš„é¡ºåºè¿½åŠ åˆ°æ—¥å¿—ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœè®°å½• M1 ç”±ä¸Žè®°å½• M2 ç›¸åŒçš„ç”Ÿæˆè€…å‘é€ï¼Œå¹¶ä¸”é¦–å…ˆå‘é€ M1 ï¼Œåˆ™ M1 å°†å…·æœ‰æ¯” M2 æ›´ä½Žçš„åç§»å¹¶ä¸”åœ¨æ—¥å¿—ä¸­æ›´æ—©å‡ºçŽ°ã€‚

* æ¶ˆè´¹è€…å®žä¾‹æŒ‰ç…§å®ƒä»¬å­˜å‚¨åœ¨æ—¥å¿—ä¸­çš„é¡ºåºæŸ¥çœ‹è®°å½•ã€‚å¯¹äºŽæ¶ˆè´¹è€…è€Œè¨€,å®ƒä»¬æ¶ˆè´¹æ¶ˆæ¯çš„é¡ºåºå’Œæ—¥å¿—ä¸­æ¶ˆæ¯é¡ºåºä¸€è‡´ã€‚

* å¦‚æžœ `Topic` çš„ `replicationfactor` ä¸º N ,é‚£ä¹ˆå…è®¸ N-1 ä¸ª kafka å®žä¾‹å¤±æ•ˆï¼Œæˆ‘ä»¬å°†å®¹å¿æœ€å¤š N-1 ä¸ªæœåŠ¡å™¨æ•…éšœï¼Œè€Œä¸ä¼šä¸¢å¤±ä»»ä½•æäº¤åˆ°æ—¥å¿—çš„è®°å½•ã€‚
 

## 1.6 kafka ä½œä¸ºæ¶ˆæ¯ç³»ç»Ÿ

Kafka çš„æµæ¦‚å¿µä¸Žä¼ ç»Ÿçš„ä¼ä¸šé‚®ä»¶ç³»ç»Ÿç›¸æ¯”å¦‚ä½•ï¼Ÿ

### 1.6.1 ä¸Žä¼ ç»Ÿæ¶ˆæ¯ç³»ç»Ÿå¯¹æ¯”

æ¶ˆæ¯ä¼ ç»Ÿä¸Šæœ‰ä¸¤ç§æ¨¡åž‹ï¼š`queuing`(é˜Ÿåˆ—) å’Œ`publish-subscribe`ï¼ˆå‘å¸ƒ - è®¢é˜…ï¼‰ã€‚

* åœ¨ `é˜Ÿåˆ—` ä¸­ï¼Œæ¶ˆè´¹è€…æ± å¯ä»¥ä»ŽæœåŠ¡å™¨è¯»å–å¹¶ä¸”æ¯ä¸ªè®°å½•è½¬åˆ°å…¶ä¸­ä¸€ä¸ª; 
* `åœ¨å‘å¸ƒ - è®¢é˜…`ä¸­ï¼Œè®°å½•è¢«å¹¿æ’­ç»™æ‰€æœ‰æ¶ˆè´¹è€…ã€‚

è¿™ä¸¤ç§æ¨¡åž‹ä¸­çš„æ¯ä¸€ç§éƒ½æœ‰ä¼˜ç‚¹å’Œç¼ºç‚¹ã€‚`é˜Ÿåˆ—` çš„ä¼˜åŠ¿åœ¨äºŽå®ƒå…è®¸æ‚¨åœ¨å¤šä¸ªæ¶ˆè´¹è€…å®žä¾‹ä¸Šåˆ’åˆ†æ•°æ®å¤„ç†ï¼Œä»Žè€Œå¯ä»¥æ‰©å±•æ‚¨çš„å¤„ç†ã€‚ä¸å¹¸çš„æ˜¯ï¼Œä¸€æ—¦ä¸€ä¸ªè¿›ç¨‹è¯»å–å®ƒå·²ç»æ¶ˆå¤±çš„æ•°æ®ï¼Œé˜Ÿåˆ—å°±ä¸æ˜¯â€‹â€‹å¤šç”¨æˆ·ã€‚`å‘å¸ƒ - è®¢é˜…` å…è®¸æ‚¨å°†æ•°æ®å¹¿æ’­åˆ°å¤šä¸ªè¿›ç¨‹ï¼Œä½†ç”±äºŽæ¯æ¡æ¶ˆæ¯éƒ½å‘é€ç»™æ¯ä¸ªè®¢é˜…è€…ï¼Œå› æ­¤æ— æ³•è¿›è¡Œæ‰©å±•å¤„ç†ã€‚

kafka çš„æ¶ˆè´¹è€…ç¾¤ä½“æ¦‚å¿µæ¦‚æ‹¬äº†è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚ä¸Žé˜Ÿåˆ—ä¸€æ ·ï¼Œä½¿ç”¨è€…ç»„å…è®¸æ‚¨å°†å¤„ç†åˆ’åˆ†ä¸ºä¸€ç»„è¿›ç¨‹ï¼ˆä½¿ç”¨è€…ç»„çš„æˆå‘˜ï¼‰ã€‚ä¸Ž `å‘å¸ƒ - è®¢é˜…` ä¸€æ ·ï¼ŒKafka å…è®¸æ‚¨å‘å¤šä¸ªæ¶ˆè´¹è€…ç»„å¹¿æ’­æ¶ˆæ¯ã€‚

 

### 1.6.2 kafka çš„ä¼˜åŠ¿

Kafka æ¨¡åž‹çš„ä¼˜åŠ¿åœ¨äºŽæ¯ä¸ªä¸»é¢˜éƒ½å…·æœ‰è¿™äº›å±žæ€§ - å®ƒå¯ä»¥æ‰©å±•å¤„ç†å¹¶ä¸”ä¹Ÿæ˜¯å¤šç”¨æˆ· - ä¸éœ€è¦é€‰æ‹©å…¶ä¸­ä¸€ä¸ªã€‚

ä¸Žä¼ ç»Ÿçš„æ¶ˆæ¯ç³»ç»Ÿç›¸æ¯”ï¼ŒKafka å…·æœ‰æ›´å¼ºçš„è®¢è´­ä¿è¯ã€‚

ä¼ ç»Ÿé˜Ÿåˆ—åœ¨æœåŠ¡å™¨ä¸ŠæŒ‰é¡ºåºä¿ç•™è®°å½•ï¼Œå¦‚æžœå¤šä¸ªæ¶ˆè´¹è€…ä»Žé˜Ÿåˆ—ä¸­æ¶ˆè€—ï¼Œåˆ™æœåŠ¡å™¨æŒ‰ç…§å­˜å‚¨é¡ºåºåˆ†å‘è®°å½•ã€‚ä½†æ˜¯ï¼Œè™½ç„¶æœåŠ¡å™¨æŒ‰é¡ºåºåˆ†å‘è®°å½•ï¼Œä½†æ˜¯è®°å½•æ˜¯å¼‚æ­¥ä¼ é€’ç»™æ¶ˆè´¹è€…çš„ï¼Œå› æ­¤å®ƒä»¬å¯èƒ½ä¼šåœ¨ä¸åŒçš„æ¶ˆè´¹è€…å¤„å‡ºçŽ°æ•…éšœã€‚è¿™å®žé™…ä¸Šæ„å‘³ç€åœ¨å­˜åœ¨å¹¶è¡Œæ¶ˆè€—çš„æƒ…å†µä¸‹ä¸¢å¤±è®°å½•çš„é¡ºåºã€‚æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿé€šå¸¸é€šè¿‡å…·æœ‰â€œç‹¬å æ¶ˆè´¹è€…â€æ¦‚å¿µæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¯¥æ¦‚å¿µåªå…è®¸ä¸€ä¸ªè¿›ç¨‹ä»Žé˜Ÿåˆ—ä¸­æ¶ˆè€—ï¼Œä½†å½“ç„¶è¿™æ„å‘³ç€å¤„ç†ä¸­æ²¡æœ‰å¹¶è¡Œæ€§ã€‚

kafka åšå¾—æ›´å¥½ã€‚é€šè¿‡åœ¨ä¸»é¢˜ä¸­å…·æœ‰å¹¶è¡Œæ€§æ¦‚å¿µ - åˆ†åŒº - ï¼ŒKafka èƒ½å¤Ÿåœ¨æ¶ˆè´¹è€…æµç¨‹æ± ä¸­æä¾›è®¢è´­ä¿è¯å’Œè´Ÿè½½å¹³è¡¡ã€‚è¿™æ˜¯é€šè¿‡å°†ä¸»é¢˜ä¸­çš„åˆ†åŒºåˆ†é…ç»™ä½¿ç”¨è€…ç»„ä¸­çš„ä½¿ç”¨è€…æ¥å®žçŽ°çš„ï¼Œä»¥ä¾¿æ¯ä¸ªåˆ†åŒºä»…ç”±è¯¥ç»„ä¸­çš„ä¸€ä¸ªä½¿ç”¨è€…ä½¿ç”¨ã€‚é€šè¿‡è¿™æ ·åšï¼Œæˆ‘ä»¬ç¡®ä¿ä½¿ç”¨è€…æ˜¯è¯¥åˆ†åŒºçš„å”¯ä¸€è¯»è€…å¹¶æŒ‰é¡ºåºä½¿ç”¨æ•°æ®ã€‚ç”±äºŽæœ‰è®¸å¤šåˆ†åŒºï¼Œè¿™ä»ç„¶å¯ä»¥å¹³è¡¡è®¸å¤šæ¶ˆè´¹è€…å®žä¾‹çš„è´Ÿè½½ã€‚ä½†è¯·æ³¨æ„ï¼Œæ¶ˆè´¹è€…ç»„ä¸­çš„æ¶ˆè´¹è€…å®žä¾‹ä¸èƒ½è¶…è¿‡åˆ†åŒºã€‚

 
TODO 

1.7 kafkaä½œä¸ºå­˜å‚¨ç³»ç»Ÿ
 ä»»ä½•å…è®¸å‘å¸ƒä¸Žæ¶ˆè´¹æ¶ˆæ¯åˆ†ç¦»çš„æ¶ˆæ¯çš„æ¶ˆæ¯é˜Ÿåˆ—å®žé™…ä¸Šå……å½“äº†æ­£åœ¨è¿›è¡Œçš„æ¶ˆæ¯çš„å­˜å‚¨ç³»ç»Ÿã€‚Kafkaçš„ä¸åŒä¹‹å¤„åœ¨äºŽå®ƒæ˜¯ä¸€ä¸ªéžå¸¸å¥½çš„å­˜å‚¨ç³»ç»Ÿã€‚
 å†™å…¥Kafkaçš„æ•°æ®å°†å†™å…¥ç£ç›˜å¹¶è¿›è¡Œå¤åˆ¶ä»¥å®žçŽ°å®¹é”™ã€‚Kafkaå…è®¸ç”Ÿäº§è€…ç­‰å¾…ç¡®è®¤ï¼Œä»¥ä¾¿åœ¨å®Œå…¨å¤åˆ¶ä¹‹å‰å†™å…¥ä¸è¢«è®¤ä¸ºæ˜¯å®Œæ•´çš„ï¼Œå¹¶ä¸”å³ä½¿å†™å…¥çš„æœåŠ¡å™¨å¤±è´¥ä¹Ÿä¿è¯å†™å…¥ä»ç„¶å­˜åœ¨ã€‚
 ç£ç›˜ç»“æž„Kafkaå¾ˆå¥½åœ°ä½¿ç”¨äº†è§„æ¨¡ - æ— è®ºæœåŠ¡å™¨ä¸Šæœ‰50 KBè¿˜æ˜¯50 TBçš„æŒä¹…æ•°æ®ï¼ŒKafkaéƒ½ä¼šæ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚
 ç”±äºŽè®¤çœŸå¯¹å¾…å­˜å‚¨å¹¶å…è®¸å®¢æˆ·ç«¯æŽ§åˆ¶å…¶è¯»å–ä½ç½®ï¼Œæ‚¨å¯ä»¥å°†Kafkaè§†ä¸ºä¸€ç§ä¸“ç”¨äºŽé«˜æ€§èƒ½ï¼Œä½Žå»¶è¿Ÿæäº¤æ—¥å¿—å­˜å‚¨ï¼Œå¤åˆ¶å’Œä¼ æ’­çš„ä¸“ç”¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚
æœ‰å…³Kafkaçš„æäº¤æ—¥å¿—å­˜å‚¨å’Œå¤åˆ¶è®¾è®¡çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·é˜…è¯»æ­¤é¡µé¢ã€‚
 

1.8 kafkaç”¨äºŽæµå¤„ç†
 ä»…ä»…è¯»å–ï¼Œå†™å…¥å’Œå­˜å‚¨æ•°æ®æµæ˜¯ä¸å¤Ÿçš„ï¼Œç›®çš„æ˜¯å®žçŽ°æµçš„å®žæ—¶å¤„ç†ã€‚
 åœ¨Kafkaä¸­ï¼Œæµå¤„ç†å™¨æ˜¯æŒ‡ä»Žè¾“å…¥ä¸»é¢˜èŽ·å–è¿žç»­æ•°æ®æµï¼Œå¯¹æ­¤è¾“å…¥æ‰§è¡ŒæŸäº›å¤„ç†ä»¥åŠç”Ÿæˆè¿žç»­æ•°æ®æµä»¥è¾“å‡ºä¸»é¢˜çš„ä»»ä½•å†…å®¹ã€‚
 ä¾‹å¦‚ï¼Œé›¶å”®åº”ç”¨ç¨‹åºå¯èƒ½ä¼šæŽ¥æ”¶é”€å”®å’Œå‘è´§çš„è¾“å…¥æµï¼Œå¹¶è¾“å‡ºé‡æ–°æŽ’åºæµå’Œæ ¹æ®æ­¤æ•°æ®è®¡ç®—çš„ä»·æ ¼è°ƒæ•´ã€‚
 å¯ä»¥ä½¿ç”¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…APIç›´æŽ¥è¿›è¡Œç®€å•å¤„ç†ã€‚ä½†æ˜¯ï¼Œå¯¹äºŽæ›´å¤æ‚çš„è½¬æ¢ï¼ŒKafkaæä¾›äº†å®Œå…¨é›†æˆçš„Streams APIã€‚è¿™å…è®¸æž„å»ºæ‰§è¡Œéžå¹³å‡¡å¤„ç†çš„åº”ç”¨ç¨‹åºï¼Œè¿™äº›åº”ç”¨ç¨‹åºå¯ä»¥è®¡ç®—æµçš„èšåˆæˆ–å°†æµè¿žæŽ¥åœ¨ä¸€èµ·ã€‚
 æ­¤å·¥å…·æœ‰åŠ©äºŽè§£å†³æ­¤ç±»åº”ç”¨ç¨‹åºé¢ä¸´çš„éš¾é¢˜ï¼šå¤„ç†æ— åºæ•°æ®ï¼Œåœ¨ä»£ç æ›´æ”¹æ—¶é‡æ–°å¤„ç†è¾“å…¥ï¼Œæ‰§è¡Œæœ‰çŠ¶æ€è®¡ç®—ç­‰ã€‚
 æµAPIæž„å»ºåœ¨Kafkaæä¾›çš„æ ¸å¿ƒåŽŸè¯­ä¸Šï¼šå®ƒä½¿ç”¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…APIè¿›è¡Œè¾“å…¥ï¼Œä½¿ç”¨Kafkaè¿›è¡Œæœ‰çŠ¶æ€å­˜å‚¨ï¼Œå¹¶åœ¨æµå¤„ç†å™¨å®žä¾‹ä¹‹é—´ä½¿ç”¨ç›¸åŒçš„ç»„æœºåˆ¶æ¥å®žçŽ°å®¹é”™ã€‚
 

2ã€kafkaä½¿ç”¨åœºæ™¯
2.1 æ¶ˆæ¯Messaging
ã€€ã€€Kafkaå¯ä»¥æ›¿ä»£æ›´ä¼ ç»Ÿçš„æ¶ˆæ¯ä»£ç†ã€‚æ¶ˆæ¯ä»£ç†çš„ä½¿ç”¨æœ‰å¤šç§åŽŸå› ï¼ˆå°†å¤„ç†ä¸Žæ•°æ®ç”Ÿæˆå™¨åˆ†ç¦»ï¼Œç¼“å†²æœªå¤„ç†çš„æ¶ˆæ¯ç­‰ï¼‰ã€‚ä¸Žå¤§å¤šæ•°æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿç›¸æ¯”ï¼ŒKafkaå…·æœ‰æ›´å¥½çš„åžåé‡ï¼Œå†…ç½®åˆ†åŒºï¼Œå¤åˆ¶å’Œå®¹é”™åŠŸèƒ½ï¼Œè¿™ä½¿å…¶æˆä¸ºå¤§è§„æ¨¡æ¶ˆæ¯å¤„ç†åº”ç”¨ç¨‹åºçš„ç†æƒ³è§£å†³æ–¹æ¡ˆã€‚

ã€€ã€€æ ¹æ®ç»éªŒï¼Œæ¶ˆæ¯ä¼ é€’çš„ä½¿ç”¨é€šå¸¸ç›¸å¯¹è¾ƒä½Žï¼Œä½†å¯èƒ½éœ€è¦è¾ƒä½Žçš„ç«¯åˆ°ç«¯å»¶è¿Ÿï¼Œå¹¶ä¸”é€šå¸¸å–å†³äºŽKafkaæä¾›çš„å¼ºå¤§çš„è€ç”¨æ€§ä¿è¯ã€‚

ã€€ã€€åœ¨è¿™ä¸ªé¢†åŸŸï¼ŒKafkaå¯ä¸Žä¼ ç»Ÿçš„æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿï¼ˆå¦‚ActiveMQæˆ– RabbitMQï¼‰ç›¸åª²ç¾Žã€‚

 

2.2 ç½‘ç«™æ´»åŠ¨è·Ÿè¸ª
ã€€ã€€Kafkaçš„åŽŸå§‹ç”¨ä¾‹æ˜¯èƒ½å¤Ÿå°†ç”¨æˆ·æ´»åŠ¨è·Ÿè¸ªç®¡é“é‡å»ºä¸ºä¸€ç»„å®žæ—¶å‘å¸ƒ - è®¢é˜…æºã€‚è¿™æ„å‘³ç€ç«™ç‚¹æ´»åŠ¨ï¼ˆé¡µé¢æŸ¥çœ‹ï¼Œæœç´¢æˆ–ç”¨æˆ·å¯èƒ½é‡‡å–çš„å…¶ä»–æ“ä½œï¼‰å°†å‘å¸ƒåˆ°ä¸­å¿ƒä¸»é¢˜ï¼Œæ¯ä¸ªæ´»åŠ¨ç±»åž‹åŒ…å«ä¸€ä¸ªä¸»é¢˜ã€‚è¿™äº›æºå¯ç”¨äºŽè®¢è´­ä¸€ç³»åˆ—ç”¨ä¾‹ï¼ŒåŒ…æ‹¬å®žæ—¶å¤„ç†ï¼Œå®žæ—¶ç›‘æŽ§ä»¥åŠåŠ è½½åˆ°Hadoopæˆ–ç¦»çº¿æ•°æ®ä»“åº“ç³»ç»Ÿä»¥è¿›è¡Œè„±æœºå¤„ç†å’ŒæŠ¥å‘Šã€‚

ã€€ã€€æ´»åŠ¨è·Ÿè¸ªé€šå¸¸éžå¸¸é«˜ï¼Œå› ä¸ºä¸ºæ¯ä¸ªç”¨æˆ·é¡µé¢è§†å›¾ç”Ÿæˆäº†è®¸å¤šæ´»åŠ¨æ¶ˆæ¯ã€‚

 

2.3 åº¦é‡Metrics
ã€€ã€€Kafkaé€šå¸¸ç”¨äºŽè¿è¥ç›‘æŽ§æ•°æ®ã€‚è¿™æ¶‰åŠä»Žåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºèšåˆç»Ÿè®¡ä¿¡æ¯ä»¥ç”Ÿæˆæ“ä½œæ•°æ®çš„é›†ä¸­å¼æè¦ã€‚

 

2.4 æ—¥å¿—èšåˆ
ã€€ã€€è®¸å¤šäººä½¿ç”¨Kafkaä½œä¸ºæ—¥å¿—èšåˆè§£å†³æ–¹æ¡ˆçš„æ›¿ä»£å“ã€‚æ—¥å¿—èšåˆé€šå¸¸ä»ŽæœåŠ¡å™¨æ”¶é›†ç‰©ç†æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬æ”¾åœ¨ä¸­å¤®ä½ç½®ï¼ˆå¯èƒ½æ˜¯æ–‡ä»¶æœåŠ¡å™¨æˆ–HDFSï¼‰è¿›è¡Œå¤„ç†ã€‚KafkaæŠ½è±¡å‡ºæ–‡ä»¶çš„ç»†èŠ‚ï¼Œå¹¶å°†æ—¥å¿—æˆ–äº‹ä»¶æ•°æ®ä½œä¸ºæ¶ˆæ¯æµæ›´æ¸…æ™°åœ°æŠ½è±¡å‡ºæ¥ã€‚è¿™å…è®¸æ›´ä½Žå»¶è¿Ÿçš„å¤„ç†å¹¶æ›´å®¹æ˜“æ”¯æŒå¤šä¸ªæ•°æ®æºå’Œåˆ†å¸ƒå¼æ•°æ®æ¶ˆè€—ã€‚ä¸ŽScribeæˆ–Flumeç­‰ä»¥æ—¥å¿—ä¸ºä¸­å¿ƒçš„ç³»ç»Ÿç›¸æ¯”ï¼ŒKafkaæä¾›äº†åŒæ ·å‡ºè‰²çš„æ€§èƒ½ï¼Œç”±äºŽå¤åˆ¶è€Œå…·æœ‰æ›´å¼ºçš„è€ç”¨æ€§ä¿è¯ï¼Œä»¥åŠæ›´ä½Žçš„ç«¯åˆ°ç«¯å»¶è¿Ÿã€‚

 

2.5 æµå¤„ç†
ã€€ã€€è®¸å¤šKafkaç”¨æˆ·åœ¨å¤„ç†ç”±å¤šä¸ªé˜¶æ®µç»„æˆçš„ç®¡é“æ—¶å¤„ç†æ•°æ®ï¼Œå…¶ä¸­åŽŸå§‹è¾“å…¥æ•°æ®ä»ŽKafkaä¸»é¢˜ä¸­æ¶ˆè´¹ï¼Œç„¶åŽèšåˆï¼Œä¸°å¯Œæˆ–ä»¥å…¶ä»–æ–¹å¼è½¬æ¢ä¸ºæ–°ä¸»é¢˜ä»¥ä¾›è¿›ä¸€æ­¥æ¶ˆè´¹æˆ–åŽç»­å¤„ç†ã€‚

ã€€ã€€ä¾‹å¦‚ï¼Œç”¨äºŽæŽ¨èæ–°é—»æ–‡ç« çš„å¤„ç†ç®¡é“å¯ä»¥ä»ŽRSSè®¢é˜…æºæŠ“å–æ–‡ç« å†…å®¹å¹¶å°†å…¶å‘å¸ƒåˆ°â€œæ–‡ç« â€ä¸»é¢˜; è¿›ä¸€æ­¥å¤„ç†å¯èƒ½ä¼šå¯¹æ­¤å†…å®¹è¿›è¡Œè§„èŒƒåŒ–æˆ–é‡å¤æ•°æ®åˆ é™¤ï¼Œå¹¶å°†å·²æ¸…ç†çš„æ–‡ç« å†…å®¹å‘å¸ƒåˆ°æ–°ä¸»é¢˜; æœ€ç»ˆå¤„ç†é˜¶æ®µå¯èƒ½ä¼šå°è¯•å‘ç”¨æˆ·æŽ¨èæ­¤å†…å®¹ã€‚æ­¤ç±»å¤„ç†ç®¡é“åŸºäºŽå„ä¸ªä¸»é¢˜åˆ›å»ºå®žæ—¶æ•°æ®æµçš„å›¾å½¢ã€‚ä»Ž0.10.0.0å¼€å§‹ï¼Œè¿™æ˜¯ä¸€ä¸ªè½»é‡çº§ä½†åŠŸèƒ½å¼ºå¤§çš„æµå¤„ç†åº“ï¼Œåä¸ºKafka Streams åœ¨Apache Kafkaä¸­å¯ç”¨äºŽæ‰§è¡Œå¦‚ä¸Šæ‰€è¿°çš„æ­¤ç±»æ•°æ®å¤„ç†ã€‚é™¤äº†Kafka Streamsä¹‹å¤–ï¼Œå…¶ä»–å¼€æºæµå¤„ç†å·¥å…·åŒ…æ‹¬Apache Stormå’Œ Apache Samzaã€‚

 

2.6 Event Sourcing
ã€€ã€€Event Sourcingæ˜¯ä¸€ç§åº”ç”¨ç¨‹åºè®¾è®¡é£Žæ ¼ï¼Œå…¶ä¸­çŠ¶æ€æ›´æ”¹è®°å½•ä¸ºæŒ‰æ—¶é—´æŽ’åºçš„è®°å½•åºåˆ—ã€‚Kafkaå¯¹éžå¸¸å¤§çš„å­˜å‚¨æ—¥å¿—æ•°æ®çš„æ”¯æŒä½¿å…¶æˆä¸ºä»¥è¿™ç§é£Žæ ¼æž„å»ºçš„åº”ç”¨ç¨‹åºçš„å‡ºè‰²åŽç«¯ã€‚

 

2.7 æäº¤æ—¥å¿—
ã€€ã€€Kafkaå¯ä»¥ä½œä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€ç§å¤–éƒ¨æäº¤æ—¥å¿—ã€‚è¯¥æ—¥å¿—æœ‰åŠ©äºŽåœ¨èŠ‚ç‚¹ä¹‹é—´å¤åˆ¶æ•°æ®ï¼Œå¹¶å……å½“æ•…éšœèŠ‚ç‚¹æ¢å¤å…¶æ•°æ®çš„é‡æ–°åŒæ­¥æœºåˆ¶ã€‚Kafkaä¸­çš„æ—¥å¿—åŽ‹ç¼©åŠŸèƒ½æœ‰åŠ©äºŽæ”¯æŒæ­¤ç”¨æ³•ã€‚åœ¨è¿™ç§ç”¨æ³•ä¸­ï¼ŒKafkaç±»ä¼¼äºŽApache BookKeeperé¡¹ç›®ã€‚

 

3ã€kafkaå®‰è£…
3.1 ä¸‹è½½å®‰è£…
åˆ°å®˜ç½‘http://kafka.apache.org/downloads.htmlä¸‹è½½æƒ³è¦çš„ç‰ˆæœ¬ï¼›æˆ‘è¿™é‡Œä¸‹è½½çš„æœ€æ–°ç¨³å®šç‰ˆ2.1.0

æ³¨ï¼šç”±äºŽKafkaæŽ§åˆ¶å°è„šæœ¬å¯¹äºŽåŸºäºŽUnixå’ŒWindowsçš„å¹³å°æ˜¯ä¸åŒçš„ï¼Œå› æ­¤åœ¨Windowså¹³å°ä¸Šä½¿ç”¨bin\windows\ è€Œä¸æ˜¯bin/ å°†è„šæœ¬æ‰©å±•åæ›´æ”¹ä¸º.batã€‚

1
2
3
[root@along ~]# wget http://mirrors.shu.edu.cn/apache/kafka/2.1.0/kafka_2.11-2.1.0.tgz
[root@along ~]# tar -C /data/ -xvf kafka_2.11-2.1.0.tgz
[root@along ~]# cd /data/kafka_2.11-2.1.0/
ã€€ã€€

3.2 é…ç½®å¯åŠ¨zookeeper
ã€€ã€€kafkaæ­£å¸¸è¿è¡Œï¼Œå¿…é¡»é…ç½®zookeeperï¼Œå¦åˆ™æ— è®ºæ˜¯kafkaé›†ç¾¤è¿˜æ˜¯å®¢æˆ·ç«¯çš„ç”Ÿå­˜è€…å’Œæ¶ˆè´¹è€…éƒ½æ— æ³•æ­£å¸¸çš„å·¥ä½œçš„ï¼›æ‰€ä»¥éœ€è¦é…ç½®å¯åŠ¨zookeeperæœåŠ¡ã€‚

ï¼ˆ1ï¼‰zookeeperéœ€è¦javaçŽ¯å¢ƒ

1
[root@along ~]# yum -y install java-1.8.0
 

ï¼ˆ2ï¼‰è¿™é‡Œkafkaä¸‹è½½åŒ…å·²ç»åŒ…æ‹¬zookeeperæœåŠ¡ï¼Œæ‰€ä»¥åªéœ€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå¯åŠ¨å³å¯ã€‚

å¦‚æžœéœ€è¦ä¸‹è½½æŒ‡å®šzookeeperç‰ˆæœ¬ï¼›å¯ä»¥å•ç‹¬åŽ»zookeeperå®˜ç½‘http://mirrors.shu.edu.cn/apache/zookeeper/ä¸‹è½½æŒ‡å®šç‰ˆæœ¬ã€‚

1
2
3
4
5
[root@along ~]# cd /data/kafka_2.11-2.1.0/
[root@along kafka_2.11-2.1.0]# grep "^[^#]" config/zookeeper.properties
dataDir=/tmp/zookeeper   #æ•°æ®å­˜å‚¨ç›®å½•
clientPort=2181   #zookeeperç«¯å£
maxClientCnxns=0
æ³¨ï¼šå¯è‡ªè¡Œæ·»åŠ ä¿®æ”¹zookeeperé…ç½®

 

3.3 é…ç½®kafka
ï¼ˆ1ï¼‰ä¿®æ”¹é…ç½®æ–‡ä»¶

1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
[root@along kafka_2.11-2.1.0]# grep "^[^#]" config/server.properties
broker.id=0
listeners=PLAINTEXT://localhost:9092
num.network.threads=3
num.io.threads=8
socket.send.buffer.bytes=102400
socket.receive.buffer.bytes=102400
socket.request.max.bytes=104857600
log.dirs=/tmp/kafka-logs
num.partitions=1
num.recovery.threads.per.data.dir=1
offsets.topic.replication.factor=1
transaction.state.log.replication.factor=1
transaction.state.log.min.isr=1
log.retention.hours=168
log.segment.bytes=1073741824
log.retention.check.interval.ms=300000
zookeeper.connect=localhost:2181
zookeeper.connection.timeout.ms=6000
group.initial.rebalance.delay.ms=0
æ³¨ï¼šå¯æ ¹æ®è‡ªå·±éœ€æ±‚ä¿®æ”¹é…ç½®æ–‡ä»¶

 broker.idï¼šå”¯ä¸€æ ‡è¯†ID
 listeners=PLAINTEXT://localhost:9092ï¼škafkaæœåŠ¡ç›‘å¬åœ°å€å’Œç«¯å£
 log.dirsï¼šæ—¥å¿—å­˜å‚¨ç›®å½•
 zookeeper.connectï¼šæŒ‡å®šzookeeperæœåŠ¡
 

ï¼ˆ2ï¼‰é…ç½®çŽ¯å¢ƒå˜é‡

1
2
3
4
[root@along ~]# vim /etc/profile.d/kafka.sh
export KAFKA_HOME="/data/kafka_2.11-2.1.0"
export PATH="${KAFKA_HOME}/bin:$PATH"
[root@along ~]# source /etc/profile.d/kafka.sh
ã€€ã€€

ï¼ˆ3ï¼‰é…ç½®æœåŠ¡å¯åŠ¨è„šæœ¬

1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
[root@along ~]# vim /etc/init.d/kafka
#!/bin/sh
#
# chkconfig: 345 99 01
# description: Kafka
#
# File : Kafka
#
# Description: Starts and stops the Kafka server
#
 
source /etc/rc.d/init.d/functions
 
KAFKA_HOME=/data/kafka_2.11-2.1.0
KAFKA_USER=root
export LOG_DIR=/tmp/kafka-logs
 
[ -e /etc/sysconfig/kafka ] && . /etc/sysconfig/kafka
 
# See how we were called.
case "$1" in
 
  start)
    echo -n "Starting Kafka:"
    /sbin/runuser -s /bin/sh $KAFKA_USER -c "nohup $KAFKA_HOME/bin/kafka-server-start.sh $KAFKA_HOME/config/server.properties > $LOG_DIR/server.out 2> $LOG_DIR/server.err &"
    echo " done."
    exit 0
    ;;
 
  stop)
    echo -n "Stopping Kafka: "
    /sbin/runuser -s /bin/sh $KAFKA_USER  -c "ps -ef | grep kafka.Kafka | grep -v grep | awk '{print \$2}' | xargs kill \-9"
    echo " done."
    exit 0
    ;;
  hardstop)
    echo -n "Stopping (hard) Kafka: "
    /sbin/runuser -s /bin/sh $KAFKA_USER  -c "ps -ef | grep kafka.Kafka | grep -v grep | awk '{print \$2}' | xargs kill -9"
    echo " done."
    exit 0
    ;;
 
  status)
    c_pid=`ps -ef | grep kafka.Kafka | grep -v grep | awk '{print $2}'`
    if [ "$c_pid" = "" ] ; then
      echo "Stopped"
      exit 3
    else
      echo "Running $c_pid"
      exit 0
    fi
    ;;
 
  restart)
    stop
    start
    ;;
 
  *)
    echo "Usage: kafka {start|stop|hardstop|status|restart}"
    exit 1
    ;;
 
esac
ã€€ã€€

3.4 å¯åŠ¨kafkaæœåŠ¡
ï¼ˆ1ï¼‰åŽå°å¯åŠ¨zookeeperæœåŠ¡

1
[root@along ~]# nohup zookeeper-server-start.sh /data/kafka_2.11-2.1.0/config/zookeeper.properties &
 

ï¼ˆ2ï¼‰å¯åŠ¨kafkaæœåŠ¡

1
2
3
4
5
6
7
8
[root@along ~]# service kafka start
Starting kafka (via systemctl):                            [  OK  ]
[root@along ~]# service kafka status
Running 86018
[root@along ~]# ss -nutl
Netid State      Recv-Q Send-Q     Local Address:Port                    Peer Address:Port                              
tcp   LISTEN     0      50                    :::9092                              :::*                 
tcp   LISTEN     0      50                    :::2181                              :::*
ã€€ã€€

4ã€kafkaä½¿ç”¨ç®€å•å…¥é—¨
4.1 åˆ›å»ºä¸»é¢˜topics
åˆ›å»ºä¸€ä¸ªåä¸ºâ€œalongâ€çš„ä¸»é¢˜ï¼Œå®ƒåªåŒ…å«ä¸€ä¸ªåˆ†åŒºï¼Œåªæœ‰ä¸€ä¸ªå‰¯æœ¬ï¼š

1
2
[root@along ~]# kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic along
Created topic "along".
å¦‚æžœæˆ‘ä»¬è¿è¡Œlist topicå‘½ä»¤ï¼Œæˆ‘ä»¬çŽ°åœ¨å¯ä»¥çœ‹åˆ°è¯¥ä¸»é¢˜ï¼š

1
2
[root@along ~]# kafka-topics.sh --list --zookeeper localhost:2181
along
ã€€ã€€

4.2 å‘é€ä¸€äº›æ¶ˆæ¯
Kafkaé™„å¸¦ä¸€ä¸ªå‘½ä»¤è¡Œå®¢æˆ·ç«¯ï¼Œå®ƒå°†ä»Žæ–‡ä»¶æˆ–æ ‡å‡†è¾“å…¥ä¸­èŽ·å–è¾“å…¥ï¼Œå¹¶å°†å…¶ä½œä¸ºæ¶ˆæ¯å‘é€åˆ°Kafkaé›†ç¾¤ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯è¡Œå°†ä½œä¸ºå•ç‹¬çš„æ¶ˆæ¯å‘é€ã€‚

è¿è¡Œç”Ÿäº§è€…ï¼Œç„¶åŽåœ¨æŽ§åˆ¶å°ä¸­é”®å…¥ä¸€äº›æ¶ˆæ¯ä»¥å‘é€åˆ°æœåŠ¡å™¨ã€‚

1
2
3
[root@along ~]# kafka-console-producer.sh --broker-list localhost:9092 --topic along
>This is a message
>This is another message
ã€€ã€€

4.3 å¯åŠ¨æ¶ˆè´¹è€…
Kafkaè¿˜æœ‰ä¸€ä¸ªå‘½ä»¤è¡Œä½¿ç”¨è€…ï¼Œå®ƒä¼šå°†æ¶ˆæ¯è½¬å‚¨åˆ°æ ‡å‡†è¾“å‡ºã€‚

1
2
3
[root@along ~]# kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic along --from-beginning
This is a message
This is another message
æ‰€æœ‰å‘½ä»¤è¡Œå·¥å…·éƒ½æœ‰å…¶ä»–é€‰é¡¹; è¿è¡Œä¸å¸¦å‚æ•°çš„å‘½ä»¤å°†æ˜¾ç¤ºæ›´è¯¦ç»†åœ°è®°å½•å®ƒä»¬çš„ä½¿ç”¨ä¿¡æ¯ã€‚

 

5ã€è®¾ç½®å¤šä»£ç†kafkaç¾¤é›†
ã€€ã€€åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨ä¸Žä¸€ä¸ªbrokerè¿è¡Œï¼Œä½†è¿™å¹¶ä¸å¥½çŽ©ã€‚å¯¹äºŽKafkaï¼Œå•ä¸ªä»£ç†åªæ˜¯ä¸€ä¸ªå¤§å°ä¸º1çš„é›†ç¾¤ï¼Œå› æ­¤é™¤äº†å¯åŠ¨ä¸€äº›ä»£ç†å®žä¾‹ä¹‹å¤–æ²¡æœ‰å¤ªå¤šå˜åŒ–ã€‚ä½†æ˜¯ä¸ºäº†æ„Ÿå—å®ƒï¼Œè®©æˆ‘ä»¬å°†æˆ‘ä»¬çš„é›†ç¾¤æ‰©å±•åˆ°ä¸‰ä¸ªèŠ‚ç‚¹ï¼ˆä»ç„¶åœ¨æˆ‘ä»¬çš„æœ¬åœ°æœºå™¨ä¸Šï¼‰ã€‚

5.1 å‡†å¤‡é…ç½®æ–‡ä»¶
1
2
3
4
5
6
7
8
9
10
11
[root@along kafka_2.11-2.1.0]# cd /data/kafka_2.11-2.1.0/
[root@along kafka_2.11-2.1.0]# cp config/server.properties config/server-1.properties
[root@along kafka_2.11-2.1.0]# cp config/server.properties config/server-2.properties
[root@along kafka_2.11-2.1.0]# vim config/server-1.properties
    broker.id=1
    listeners=PLAINTEXT://:9093
    log.dirs=/tmp/kafka-logs-1
[root@along kafka_2.11-2.1.0]# vim config/server-2.properties
    broker.id=2
    listeners=PLAINTEXT://:9094
    log.dirs=/tmp/kafka-logs-2
æ³¨ï¼šè¯¥broker.id å±žæ€§æ˜¯ç¾¤é›†ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å”¯ä¸€ä¸”æ°¸ä¹…çš„åç§°ã€‚æˆ‘ä»¬å¿…é¡»è¦†ç›–ç«¯å£å’Œæ—¥å¿—ç›®å½•ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨åŒä¸€å°æœºå™¨ä¸Šè¿è¡Œè¿™äº›ï¼Œå¹¶ä¸”æˆ‘ä»¬å¸Œæœ›è®©æ‰€æœ‰ä»£ç†å°è¯•åœ¨åŒä¸€ç«¯å£ä¸Šæ³¨å†Œæˆ–è¦†ç›–å½¼æ­¤çš„æ•°æ®ã€‚

 

5.2 å¼€å¯é›†ç¾¤å¦2ä¸ªkafkaæœåŠ¡
1
2
3
4
5
6
7
[root@along ~]# nohup kafka-server-start.sh /data/kafka_2.11-2.1.0/config/server-1.properties &
[root@along ~]# nohup kafka-server-start.sh /data/kafka_2.11-2.1.0/config/server-2.properties &
[root@along ~]# ss -nutl
Netid State      Recv-Q Send-Q     Local Address:Port                    Peer Address:Port                          
tcp   LISTEN     0      50      ::ffff:127.0.0.1:9092                              :::*                 
tcp   LISTEN     0      50      ::ffff:127.0.0.1:9093                              :::*                                
tcp   LISTEN     0      50      ::ffff:127.0.0.1:9094                              :::*
ã€€ã€€

5.3 åœ¨é›†ç¾¤ä¸­è¿›è¡Œæ“ä½œ
ï¼ˆ1ï¼‰çŽ°åœ¨åˆ›å»ºä¸€ä¸ªå¤åˆ¶å› å­ä¸º3çš„æ–°ä¸»é¢˜my-replicated-topic

1
2
[root@along ~]# kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 3 --partitions 1 --topic my-replicated-topic
Created topic "my-replicated-topic".
ã€€ã€€

ï¼ˆ2ï¼‰åœ¨ä¸€ä¸ªé›†ç¾¤ä¸­ï¼Œè¿è¡Œâ€œdescribe topicsâ€å‘½ä»¤æŸ¥çœ‹å“ªä¸ªbrokeræ­£åœ¨åšä»€ä¹ˆ

1
2
3
[root@along ~]# kafka-topics.sh --describe --zookeeper localhost:2181 --topic my-replicated-topic
Topic:my-replicated-topic   PartitionCount:1    ReplicationFactor:3 Configs:
    Topic: my-replicated-topic  Partition: 0    Leader: 2   Replicas: 2,0,1 Isr: 2,0,1
æ³¨é‡Šï¼šç¬¬ä¸€è¡Œç»™å‡ºäº†æ‰€æœ‰åˆ†åŒºçš„æ‘˜è¦ï¼Œæ¯ä¸ªé™„åŠ è¡Œæä¾›æœ‰å…³ä¸€ä¸ªåˆ†åŒºçš„ä¿¡æ¯ã€‚ç”±äºŽæˆ‘ä»¬åªæœ‰ä¸€ä¸ªåˆ†åŒºç”¨äºŽæ­¤ä¸»é¢˜ï¼Œå› æ­¤åªæœ‰ä¸€è¡Œã€‚

 â€œleaderâ€æ˜¯è´Ÿè´£ç»™å®šåˆ†åŒºçš„æ‰€æœ‰è¯»å–å’Œå†™å…¥çš„èŠ‚ç‚¹ã€‚æ¯ä¸ªèŠ‚ç‚¹å°†æˆä¸ºéšæœºé€‰æ‹©çš„åˆ†åŒºéƒ¨åˆ†çš„é¢†å¯¼è€…ã€‚
 â€œreplicasâ€æ˜¯å¤åˆ¶æ­¤åˆ†åŒºæ—¥å¿—çš„èŠ‚ç‚¹åˆ—è¡¨ï¼Œæ— è®ºå®ƒä»¬æ˜¯å¦ä¸ºé¢†å¯¼è€…ï¼Œæˆ–è€…å³ä½¿å®ƒä»¬å½“å‰å¤„äºŽæ´»åŠ¨çŠ¶æ€ã€‚
 â€œisrâ€æ˜¯â€œåŒæ­¥â€å¤åˆ¶å“çš„é›†åˆã€‚è¿™æ˜¯å‰¯æœ¬åˆ—è¡¨çš„å­é›†ï¼Œè¯¥åˆ—è¡¨å½“å‰å¤„äºŽæ´»è·ƒçŠ¶æ€å¹¶ä¸”å·²ç»è¢«é¢†å¯¼è€…æ•èŽ·ã€‚
è¯·æ³¨æ„ï¼ŒLeader: 2ï¼Œåœ¨æˆ‘çš„ç¤ºä¾‹ä¸­ï¼ŒèŠ‚ç‚¹2 æ˜¯è¯¥ä¸»é¢˜çš„å”¯ä¸€åˆ†åŒºçš„Leaderã€‚

 

ï¼ˆ3ï¼‰å¯ä»¥åœ¨æˆ‘ä»¬åˆ›å»ºçš„åŽŸå§‹ä¸»é¢˜ä¸Šè¿è¡Œç›¸åŒçš„å‘½ä»¤ï¼Œä»¥æŸ¥çœ‹å®ƒçš„ä½ç½®

1
2
3
[root@along ~]# kafka-topics.sh --describe --zookeeper localhost:2181 --topic along
Topic:along PartitionCount:1    ReplicationFactor:1 Configs:
    Topic: along    Partition: 0    Leader: 0   Replicas: 0 Isr: 0
ã€€ã€€

ï¼ˆ4ï¼‰å‘æˆ‘ä»¬çš„æ–°ä¸»é¢˜å‘å¸ƒä¸€äº›æ¶ˆæ¯ï¼š

1
2
3
4
[root@along ~]# kafka-console-producer.sh --broker-list localhost:9092 --topic my-replicated-topic
>my test message 1
>my test message 2
>^C
ã€€ã€€

ï¼ˆ5ï¼‰çŽ°åœ¨è®©æˆ‘ä»¬ä½¿ç”¨è¿™äº›æ¶ˆæ¯ï¼š

1
2
3
[root@along ~]# kafka-console-consumer.sh --bootstrap-server localhost:9092 --from-beginning --topic my-replicated-topic
my test message 1
my test message 2
ã€€ã€€

5.4 æµ‹è¯•é›†ç¾¤çš„å®¹é”™æ€§
ï¼ˆ1ï¼‰çŽ°åœ¨è®©æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹å®¹é”™æ€§ã€‚Broker 2 å……å½“leader æ‰€ä»¥è®©æˆ‘ä»¬æ€äº†å®ƒï¼š

1
2
3
4
5
6
[root@along ~]# ps aux | grep server-2.properties |awk '{print $2}'
106737
[root@along ~]# kill -9 106737
[root@along ~]# ss -nutl
tcp   LISTEN     0      50      ::ffff:127.0.0.1:9092                              :::*                       
tcp   LISTEN     0      50      ::ffff:127.0.0.1:9093                              :::*
ã€€ã€€

ï¼ˆ2ï¼‰leader å·²åˆ‡æ¢åˆ°å…¶ä¸­ä¸€ä¸ªä»Žå±žèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹2ä¸å†ä½äºŽåŒæ­¥å‰¯æœ¬é›†ä¸­ï¼š

1
2
3
[root@along ~]# kafka-topics.sh --describe --zookeeper localhost:2181 --topic my-replicated-topic
Topic:my-replicated-topic   PartitionCount:1    ReplicationFactor:3 Configs:
    Topic: my-replicated-topic  Partition: 0    Leader: 0   Replicas: 2,0,1 Isr: 0,1
ã€€ã€€

ï¼ˆ3ï¼‰å³ä½¿æœ€åˆæŽ¥å—å†™å…¥çš„leader å·²ç»å¤±è´¥ï¼Œè¿™äº›æ¶ˆæ¯ä»å¯ä¾›æ¶ˆè´¹ï¼š

1
2
3
[root@along ~]# kafka-console-consumer.sh --bootstrap-server localhost:9092 --from-beginning --topic my-replicated-topic
my test message 1
my test message 2
ã€€ã€€

6ã€ä½¿ç”¨Kafka Connectå¯¼å…¥/å¯¼å‡ºæ•°æ®
ã€€ã€€ä»ŽæŽ§åˆ¶å°å†™å…¥æ•°æ®å¹¶å°†å…¶å†™å›žæŽ§åˆ¶å°æ˜¯ä¸€ä¸ªæ–¹ä¾¿çš„èµ·ç‚¹ï¼Œä½†æœ‰æ—¶å€™å¯èƒ½å¸Œæœ›ä½¿ç”¨å…¶ä»–æ¥æºçš„æ•°æ®æˆ–å°†æ•°æ®ä»ŽKafkaå¯¼å‡ºåˆ°å…¶ä»–ç³»ç»Ÿã€‚å¯¹äºŽè®¸å¤šç³»ç»Ÿï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Kafka Connectå¯¼å…¥æˆ–å¯¼å‡ºæ•°æ®ï¼Œè€Œä¸æ˜¯ç¼–å†™è‡ªå®šä¹‰é›†æˆä»£ç ã€‚

ã€€ã€€Kafka Connectæ˜¯Kafkaé™„å¸¦çš„å·¥å…·ï¼Œç”¨äºŽå‘Kafkaå¯¼å…¥å’Œå¯¼å‡ºæ•°æ®ã€‚å®ƒæ˜¯ä¸€ä¸ªå¯æ‰©å±•çš„å·¥å…·ï¼Œè¿è¡Œè¿žæŽ¥å™¨ï¼Œå®žçŽ°ä¸Žå¤–éƒ¨ç³»ç»Ÿäº¤äº’çš„è‡ªå®šä¹‰â€‹â€‹é€»è¾‘ã€‚åœ¨æœ¬å¿«é€Ÿå…¥é—¨ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ä½¿ç”¨ç®€å•çš„è¿žæŽ¥å™¨è¿è¡ŒKafka Connectï¼Œè¿™äº›è¿žæŽ¥å™¨å°†æ•°æ®ä»Žæ–‡ä»¶å¯¼å…¥Kafkaä¸»é¢˜å¹¶å°†æ•°æ®ä»ŽKafkaä¸»é¢˜å¯¼å‡ºåˆ°æ–‡ä»¶ã€‚

ï¼ˆ1ï¼‰é¦–å…ˆåˆ›å»ºä¸€äº›ç§å­æ•°æ®è¿›è¡Œæµ‹è¯•ï¼š

1
[root@along ~]# echo -e "foo\nbar" > test.txt
æˆ–è€…åœ¨Windowsä¸Šï¼š

1
2
> echo foo> test.txt
> echo bar>> test.txt
ã€€ã€€

ï¼ˆ2ï¼‰æŽ¥ä¸‹æ¥ï¼Œå¯åŠ¨ä¸¤ä¸ªä»¥ç‹¬ç«‹æ¨¡å¼è¿è¡Œçš„è¿žæŽ¥å™¨ï¼Œè¿™æ„å‘³ç€å®ƒä»¬åœ¨å•ä¸ªæœ¬åœ°ä¸“ç”¨è¿›ç¨‹ä¸­è¿è¡Œã€‚æä¾›ä¸‰ä¸ªé…ç½®æ–‡ä»¶ä½œä¸ºå‚æ•°ã€‚

 ç¬¬ä¸€ä¸ªå§‹ç»ˆæ˜¯Kafka Connectæµç¨‹çš„é…ç½®ï¼ŒåŒ…å«å¸¸è§é…ç½®ï¼Œä¾‹å¦‚è¦è¿žæŽ¥çš„Kafkaä»£ç†å’Œæ•°æ®çš„åºåˆ—åŒ–æ ¼å¼ã€‚
 å…¶ä½™é…ç½®æ–‡ä»¶å‡æŒ‡å®šè¦åˆ›å»ºçš„è¿žæŽ¥å™¨ã€‚è¿™äº›æ–‡ä»¶åŒ…æ‹¬å”¯ä¸€çš„è¿žæŽ¥å™¨åç§°ï¼Œè¦å®žä¾‹åŒ–çš„è¿žæŽ¥å™¨ç±»ä»¥åŠè¿žæŽ¥å™¨æ‰€éœ€çš„ä»»ä½•å…¶ä»–é…ç½®ã€‚
1
2
3
4
[root@along ~]# connect-standalone.sh config/connect-standalone.properties config/connect-file-source.properties config/connect-file-sink.properties
[2019-01-16 16:16:31,884] INFO Kafka Connect standalone worker initializing ... (org.apache.kafka.connect.cli.ConnectStandalone:67)
[2019-01-16 16:16:31,903] INFO WorkerInfo values:
... ...
ã€€ã€€æ³¨ï¼šKafkaé™„å¸¦çš„è¿™äº›ç¤ºä¾‹é…ç½®æ–‡ä»¶ä½¿ç”¨æ‚¨ä¹‹å‰å¯åŠ¨çš„é»˜è®¤æœ¬åœ°ç¾¤é›†é…ç½®å¹¶åˆ›å»ºä¸¤ä¸ªè¿žæŽ¥å™¨ï¼šç¬¬ä¸€ä¸ªæ˜¯æºè¿žæŽ¥å™¨ï¼Œå®ƒä»Žè¾“å…¥æ–‡ä»¶è¯»å–è¡Œå¹¶ç”Ÿæˆæ¯ä¸ªKafkaä¸»é¢˜ï¼Œç¬¬äºŒä¸ªæ˜¯å®¿è¿žæŽ¥å™¨ä»ŽKafkaä¸»é¢˜è¯»å–æ¶ˆæ¯å¹¶å°†æ¯ä¸ªæ¶ˆæ¯ç”Ÿæˆä¸ºè¾“å‡ºæ–‡ä»¶ä¸­çš„ä¸€è¡Œã€‚

 

ï¼ˆ3ï¼‰éªŒè¯æ˜¯å¦å¯¼å…¥æˆåŠŸï¼ˆå¦èµ·ç»ˆç«¯ï¼‰

åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œæ‚¨å°†çœ‹åˆ°è®¸å¤šæ—¥å¿—æ¶ˆæ¯ï¼ŒåŒ…æ‹¬ä¸€äº›æŒ‡ç¤ºæ­£åœ¨å®žä¾‹åŒ–è¿žæŽ¥å™¨çš„æ—¥å¿—æ¶ˆæ¯ã€‚

â‘  ä¸€æ—¦Kafka Connectè¿›ç¨‹å¯åŠ¨ï¼Œæºè¿žæŽ¥å™¨åº”è¯¥å¼€å§‹ä»Žtest.txtä¸»é¢˜è¯»å–è¡Œå¹¶å°†å…¶ç”Ÿæˆåˆ°ä¸»é¢˜connect-testï¼Œå¹¶ä¸”æŽ¥æ”¶å™¨è¿žæŽ¥å™¨åº”è¯¥å¼€å§‹ä»Žä¸»é¢˜è¯»å–æ¶ˆæ¯connect-test å¹¶å°†å®ƒä»¬å†™å…¥æ–‡ä»¶test.sink.txtã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ£€æŸ¥è¾“å‡ºæ–‡ä»¶çš„å†…å®¹æ¥éªŒè¯æ•°æ®æ˜¯å¦å·²é€šè¿‡æ•´ä¸ªç®¡é“ä¼ é€’ï¼š

1
2
3
[root@along ~]# cat test.sink.txt
foo
bar
ã€€ã€€

â‘¡ è¯·æ³¨æ„ï¼Œæ•°æ®å­˜å‚¨åœ¨Kafkaä¸»é¢˜ä¸­connect-testï¼Œå› æ­¤æˆ‘ä»¬è¿˜å¯ä»¥è¿è¡ŒæŽ§åˆ¶å°ä½¿ç”¨è€…æ¥æŸ¥çœ‹ä¸»é¢˜ä¸­çš„æ•°æ®ï¼ˆæˆ–ä½¿ç”¨è‡ªå®šä¹‰ä½¿ç”¨è€…ä»£ç æ¥å¤„ç†å®ƒï¼‰ï¼š

1
2
3
[root@along ~]# kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic connect-test --from-beginning
{"schema":{"type":"string","optional":false},"payload":"foo"}
{"schema":{"type":"string","optional":false},"payload":"bar"}
ã€€ã€€

ï¼ˆ4ï¼‰ç»§ç»­è¿½åŠ æ•°æ®ï¼ŒéªŒè¯

1
2
3
4
5
6
7
8
9
[root@along ~]# echo Another line>> test.txt     
[root@along ~]# cat test.sink.txt
foo
bar
Another line
[root@along ~]# kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic connect-test --from-beginning
{"schema":{"type":"string","optional":false},"payload":"foo"}
{"schema":{"type":"string","optional":false},"payload":"bar"}
{"schema":{"type":"string","optional":false},"payload":"Another line"}
 